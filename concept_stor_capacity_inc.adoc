---
sidebar: sidebar 
permalink: concept_stor_capacity_inc.html 
keywords: ontap select, deploy, increase storage 
summary: ONTAP Deploy は、 ONTAP Select クラスタ内の各ノードにストレージを追加し、ライセンスを付与するために使用できます。 
---
= ストレージ容量の拡張
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAP Deploy は、 ONTAP Select クラスタ内の各ノードにストレージを追加し、ライセンスを付与するために使用できます。

ONTAP Deploy のストレージ追加機能は、管理下のストレージを増やす唯一の方法であり、 ONTAP Select VM を直接変更することはできません。次の図に、ストレージ追加ウィザードを開始する「 + 」アイコンを示します。

image:ST_05.jpg["クラスタとノードの詳細"]

ここでは、容量を拡張する際の重要な考慮事項を記載します。既存のライセンスがスペースの総容量（既存の容量と新規の容量の合計）に対応している必要があります。ノードがライセンスされた容量を超えることになるストレージ追加処理は失敗します。最初に十分な容量の新しいライセンスをインストールしておく必要があります。

既存の ONTAP Select アグリゲートに容量を追加する場合は、新しいストレージプール（データストア）に既存のストレージプールと同様のパフォーマンスプロファイルが必要です。AFF に似たパーソナリティ（フラッシュが有効）とともにインストールされた ONTAP Select ノードに、 SSD 以外のストレージを追加することはできません。DAS と外付けストレージの混在もサポートされていません。

ローカル接続ストレージをシステムに追加して新たなローカル（ DAS ）ストレージプールにする場合は、 RAID グループおよび LUN を追加で作成する必要があります。FAS システムと同様に、新しいスペースを同じアグリゲートに追加する場合は、新しい RAID グループのパフォーマンスが元の RAID グループとほぼ同じになるようにする必要があります。アグリゲートを新規に作成する場合は、新しい RAID グループに別のレイアウト使用してもかまいませんが、新しいアグリゲートがパフォーマンスに与える影響を十分に理解しておく必要があります。

データストアの合計サイズが ESX でサポートされる最大データストアサイズを超えないかぎり、新しいスペースはエクステントとして同じデータストアに追加できます。ONTAP Select がインストールされているデータストアには、データストアエクステントを動的に追加でき、 ONTAP Select ノードの処理には影響しません。

ONTAP Select ノードが HA ペアの一部である場合は、さらにいくつかの点を考慮する必要があります。

HA ペアでは、各ノードにパートナーのデータのミラーコピーが格納されます。ノード 1 にスペースを追加する場合は、ノード 1 のすべてのデータがノード 2 にレプリケートされるように、同量のスペースをパートナーノード 2 に追加する必要があります。つまり、ノード 1 の容量を追加した結果としてノード 2 に追加された容量は、ノード 2 では認識されず、アクセスすることもできません。ノード 2 にスペースが追加されるのは、 HA イベントの際にノード 1 のデータを完全に保護するためです。

パフォーマンスについてさらに考慮する必要があります。ノード 1 のデータは、ノード 2 に同期的にレプリケートされます。このため、ノード 1 の新しいスペース（データストア）のパフォーマンスが、ノード 2 の新しいスペース（データストア）のパフォーマンスと一致している必要があります。つまり、両方のノードにスペースを追加しても、ドライブテクノロジや RAID グループサイズが異なっていると、パフォーマンスに問題が生じるおそれがあります。これは、パートナーノードにデータのコピーを保持するために使用される RAID SyncMirror 処理が原因です。

HA ペアの両方のノードでユーザがアクセスできる容量を増やすには、ノードごとに 1 つ、合計 2 つの処理を実行する必要があります。各ストレージ追加処理で、両方のノードに追加のスペースが必要となります。各ノードで必要な合計スペースは、ノード 1 で必要なスペースとノード 2 で必要なスペースの合計です。

初期セットアップでは、 2 つのノードがあり、各ノードにはスペースが 30TB のデータストアが 2 つあります。ONTAP Deploy は 2 ノードクラスタを作成し、各ノードはデータストア 1 から 10TB のスペースを使用します。ONTAP Deploy は、各ノードに 5TB のアクティブスペースを設定します。

次の図は、ノード 1 に対する単一ストレージの追加操作の結果を示しています。ONTAP Select は引き続き各ノードで同じ量のストレージ（ 15TB ）を使用します。ただし、ノード 1 には、ノード 2 （ 5TB ）よりアクティブなストレージ（ 10TB ）があります。両方のノードは、各ノードがもう一方のノードのデータのコピーをホストするため、完全に保護されます。データストア 1 にはさらに空きスペースが残っており、データストア 2 はすべて空きスペースのままです。

* 容量配分： 1 回のストレージ追加操作後の割り当てと空き容量 *

image:ST_06.jpg["容量の配分： 1 回のストレージ追加操作後の割り当てと空きスペース"]

ノード 1 でさらにストレージ追加処理を実行すると、データストア 1 の残りの空きスペースとデータストア 2 の一部が使用されます（容量の上限を使用）。最初のストレージ追加処理では、データストア 1 に残っている 15TB の空きスペースが使用されます。次の図は、 2 つ目のストレージ追加処理の結果を示しています。この時点で、ノード 1 には 50TB のアクティブデータが管理下にあり、ノード 2 には元の 5TB があります。

* 容量配分：ノード 1 に対する 2 つのストレージ追加操作後の割り当てと空き容量 *

image:ST_07.jpg["容量の配分：ノード 1 に対する 2 つのストレージの追加操作後の割り当てと空きスペース"]

容量追加処理で使用される VMDK の最大サイズは 16TB です。クラスタ作成処理で使用できる VMDK の最大サイズは引き続き 8TB です。ONTAP Deploy では、構成（シングルノードクラスタまたはマルチノードクラスタ）および追加する容量に応じて、適切なサイズの VMDK が作成されます。ただし、各 VMDK の最大サイズは、クラスタ作成処理の場合は 8TB 、ストレージ追加処理の場合は 16TB です。



== ソフトウェアRAIDを使用したONTAP Selectの容量の拡張

ストレージ追加ウィザードを使用すると、ソフトウェア RAID を使用して、 ONTAP Select ノードの管理下にある容量を増やすことができます。このウィザードでは、使用可能な DAS SDD ドライブのみが表示され、 ONTAP Select VM に RDM としてマッピングできます。

容量ライセンスを 1TB 単位で増やすことはできますが、ソフトウェア RAID を使用する場合は、容量を物理的に 1TB 単位で増やすことはできません。FAS または AFF アレイにディスクを追加する場合と同様に、 1 回の操作で追加できるストレージの最小容量は、特定の要因によって決まります。

HA ペアでノード 1 にストレージを追加するには、ノードの HA ペア（ノード 2 ）でも同じ数のドライブを使用できる必要があります。ローカルドライブとリモートディスクの両方が、ノード 1 での 1 回のストレージ追加処理で使用されます。つまり、リモートドライブを使用して、ノード 1 の新しいストレージがノード 2 にレプリケートされ、保護されることが確認されます。ローカルで使用可能なストレージをノード 2 に追加するには、両方のノードで、別のストレージ追加処理を実行し、別途同数のドライブを使用できる必要があります。

ONTAP Select は、新しいドライブを既存のドライブと同じルート、データ、データパーティションにパーティショニングします。パーティショニング処理は、新しいアグリゲートの作成時、または既存のアグリゲートの拡張時に実行されます。各ディスクのルートパーティションストライプサイズは、既存ディスクの既存のルートパーティションサイズと一致するように設定されます。したがって、 2 つの同じデータパーティションサイズのそれぞれについて、ディスクの合計容量からルートパーティションサイズを引いた値を 2 で割った値を算出できます。ルートパーティションストライプサイズは可変で、初期クラスタセットアップ時に次のように計算されます。必要なルートスペースの合計（シングルノードクラスタの場合は 68GB 、 HA ペアの場合は 136GB ）を、最初のディスク数からスペアドライブとパリティドライブを引いた数で割ります。ルートパーティションストライプサイズは、システムに追加されるすべてのドライブで一定になるように維持されます。

新しいアグリゲートを作成する場合、必要な最小ドライブ数は、 RAID タイプ、および ONTAP Select ノードが HA ペアの一部かどうかによって異なります。

既存のアグリゲートにストレージを追加する場合は、さらに考慮すべき点があります。RAID グループがまだ最大数に達していない場合は、既存の RAID グループにドライブを追加できます。既存の RAID グループにスピンドルを追加する際の従来の FAS と AFF のベストプラクティスがここでも適用され、新しいスピンドルにホットスポットができる点が懸念事項となります。また、既存の RAID グループに追加できるのは、データパーティションのサイズが同じかそれ以上のドライブだけです。前述したように、データパーティションのサイズは、ドライブの物理サイズとは異なります。追加するデータパーティションが既存のパーティションより大きい場合、新しいドライブは適切なサイズに調整されます。つまり、新しい各ドライブの容量には使用されない部分が残ります。

新しいドライブを使用して、既存のアグリゲートの一部として新しい RAID グループを作成することもできます。この場合、 RAID グループのサイズは既存の RAID グループのサイズと同じである必要があります。
