---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: 2NIC 構成と 4NIC 構成の ONTAP Select vSwitch 構成とロードバランシングポリシー。 
---
= ESXiでのONTAP Select VMware vSphere vSwitchの設定
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
2NIC 構成と 4NIC 構成の ONTAP Select vSwitch 構成とロードバランシングポリシー。

ONTAP Select は、標準 vSwitch 構成と分散 vSwitch 構成の両方の使用をサポートしています。分散 vSwitch はリンク アグリゲーション構造 (LACP) をサポートします。リンク アグリゲーションは、複数の物理アダプタ間で帯域幅を集約するために使用される一般的なネットワーク構造です。LACP はベンダー中立の標準です。物理ネットワーク ポートのグループを単一の論理チャネルにまとめる、ネットワーク エンドポイント用のオープン プロトコルを提供します。ONTAP Select は、リンク アグリゲーション グループ (LAG) として設定されたポート グループで動作します。ただし、 NetApp、LAG 構成を回避するために、個々の物理ポートを単純なアップリンク (トランク) ポートとして使用することをお勧めします。このような場合、標準 vSwitch と分散 vSwitch のベスト プラクティスは同じです。

このセクションでは、 2NIC 構成と 4NIC 構成で使用する必要がある vSwitch 構成とロードバランシングポリシーについて説明します。

ONTAP Selectのポート グループを設定するときは、次のベスト プラクティスに従ってください。ポート グループ レベルのロード バランシング ポリシーは、発信元仮想ポート ID に基づいたルートです。VMware では、ESXi ホストに接続されたスイッチ ポートで STP を Portfast に設定することを推奨しています。

すべての vSwitch 構成では、単一の NIC チームにバンドルされた少なくとも 2 つの物理ネットワーク アダプタが必要です。ONTAP Select は、 2 ノード クラスタに対して単一の 10Gb リンクをサポートします。ただし、 NetApp、ハードウェアの冗長性を確保するために NIC アグリゲーションの使用を推奨しています。

vSphere サーバでは、 NIC チームをアグリゲーションの構成要素として使用し、複数の物理ネットワークアダプタを 1 つの論理チャネルにまとめることで、ネットワークの負荷をすべてのメンバーポート間で分散します。重要な点は、物理スイッチのサポートがなくても NIC チームを作成できることです。ロードバランシングポリシーとフェイルオーバーポリシーは NIC チームに直接適用でき、 NIC チームはアップストリームのスイッチ構成を認識しません。この場合、ポリシーはアウトバウンドトラフィックにのみ適用されます。


NOTE: 静的ポート チャネルはONTAP Selectではサポートされません。LACP 対応チャネルは分散 vSwitch でサポートされていますが、LACP LAG を使用すると、LAG メンバー間で負荷が不均等に分散される可能性があります。

単一ノード クラスタの場合、 ONTAP Deploy は、外部ネットワーク用のポート グループと、クラスタおよびノー​​ド管理トラフィック用の同じポート グループまたはオプションで別のポート グループを使用するようにONTAP Select VM を構成します。単一ノード クラスターの場合、必要な数の物理ポートをアクティブ アダプターとして外部ポート グループに追加できます。

マルチノードクラスタの場合、 ONTAP Deploy は、内部ネットワーク用に 1 つまたは 2 つのポートグループを使用し、外部ネットワーク用に 1 つまたは 2 つのポートグループを使用するように各 ONTAP Select VM を構成します。クラスタおよびノード管理トラフィックは、外部トラフィックと同じポートグループを使用することも、オプションで別のポートグループを使用することもできます。クラスタおよびノード管理トラフィックは、内部トラフィックと同じポートグループを共有できません。


NOTE: ONTAP Selectは最大4つのVMNICをサポートします。



== 標準または分散 vSwitch および各ノードの 4 つの物理ポート

マルチノード クラスター内の各ノードに 4 つのポート グループを割り当てることができます。各ポート グループには、次の図に示すように、1 つのアクティブ物理ポートと 3 つのスタンバイ物理ポートがあります。

* 各ノードに 4 つの物理ポートを備えた vSwitch *

image:DDN_08.jpg["ノードごとに 4 つの物理ポートを備えた vSwitch"]

スタンバイリストのポートの順序は重要です。次の表に、 4 つのポートグループにまたがる物理ポートの分散例を示します。

* ネットワークの最小構成と推奨構成 *

[cols="5*"]
|===
| ポートグループ | 外部 1. | 外部 2. | 内部 1 | 内部 2 


| アクティブ | vmnic0 | vmnic1. | vmnic2. | vmnic3. 


| スタンバイ 1. | vmnic1. | vmnic0 | vmnic3. | vmnic2. 


| スタンバイ 2. | vmnic2. | vmnic3. | vmnic0 | vmnic1. 


| スタンバイ 3. | vmnic3. | vmnic2. | vmnic1. | vmnic0 
|===
次の図は、vCenter UI からの外部ネットワーク ポート グループ（ONTAP-External およびONTAP-External2）の設定を示しています。アクティブなアダプタは異なるネットワーク カードに接続されていることに注意してください。この設定では、vmnic 4 と vmnic 5 は同じ物理 NIC 上のデュアル ポートであり、vmnic 6 と vmnic 7 は同様に別の NIC 上のデュアル ポートです（この例では、vnmics 0 ～ 3 は使用されていません）。スタンバイ アダプタの順序により、内部ネットワークのポートが最後に表示される階層的なフェイルオーバーが実現されます。スタンバイ リスト内の内部ポートの順序も、2 つの外部ポート グループ間で同様に入れ替わっています。

* パート 1 ： ONTAP Select 外部ポートグループの設定 *

image:DDN_09.jpg["パート 1 ： ONTAP Select 外部ポートグループの設定"]

* パート 2 ： ONTAP Select 外部ポートグループの設定 *

image:DDN_10.jpg["パート 2 ： ONTAP Select の外部ポートグループの設定"]

見やすさを考慮して、次のように割り当てます。

[cols="2*"]
|===
| ONTAP - 外部 | ONTAP-External2 


| アクティブアダプタ： vmnic5 スタンバイアダプタ： vmnic7 、 vmnic4 、 vmnic6 | アクティブアダプタ： vmnic7 スタンバイアダプタ： vmnic5 、 vmnic6 、 vmnic4 
|===
次の図は、内部ネットワークポートグループの設定（ ONTAP-Internal および ONTAP-Internal2 ）を示しています。アクティブなアダプタは、異なるネットワークカードからのものです。この設定では、 vmnic 4 と vmnic 5 は同じ物理 ASIC 上のデュアルポートであり、 vmnic 6 と vmnic 7 は別の ASIC 上の同様のデュアルポートです。スタンバイアダプタの順序は階層型のフェイルオーバーを提供し、外部ネットワークのポートは最後になります。スタンバイリストの外部ポートの順序も、 2 つの内部ポートグループ間で同様に入れ替わります。

* 第 1 部： ONTAP Select 内部ポートグループ設定 *

image:DDN_11.jpg["パート 1 ： ONTAP Select の内部ポートグループの設定"]

* 第 2 部： ONTAP Select 内部ポートグループ *

image:DDN_12.jpg["パート 2 ： ONTAP Select の内部ポートグループ"]

見やすさを考慮して、次のように割り当てます。

[cols="2*"]
|===
| ONTAP - 内部 | ONTAP-Internal2 


| アクティブアダプタ： vmnic4 スタンバイアダプタ： vmnic6 、 vmnic5 、 vmnic7 | アクティブアダプタ： vmnic6 スタンバイアダプタ： vmnic4 、 vmnic7 、 vmnic5 
|===


== 標準または分散 vSwitch および各ノードに 2 つの物理ポート

2 つの高速 (25/40Gb) NIC を使用する場合、推奨されるポート グループ構成は、概念的には 4 つの 10Gb アダプタを使用した構成と非常に似ています。物理アダプタを 2 つだけ使用する場合でも、4 つのポート グループを使用する必要があります。ポート グループの割り当ては次のとおりです。

[cols="5*"]
|===
| ポートグループ | 外部 1 （ e0a 、 e0b ） | 内部 1 （ e0c 、 e0e ） | 内部 2 （ e0d 、 e0f ） | 外部 2 （ e0g ） 


| アクティブ | vmnic0 | vmnic0 | vmnic1. | vmnic1. 


| スタンバイ | vmnic1. | vmnic1. | vmnic0 | vmnic0 
|===
* ノードごとに 2 つの高速（ 25 / 40GB ）物理ポートを備えた vSwitch *

image:DDN_17.jpg["ノードごとに 2 つの高速（ 25 / 40GB ）物理ポートを備えた vSwitch"]

2 つの物理ポート（ 10Gb 以下）を使用する場合は、各ポートグループにアクティブアダプタとスタンバイアダプタが相互に反対に設定されている必要があります。内部ネットワークは、マルチノード ONTAP Select クラスタにのみ存在します。シングルノードクラスタの場合は、外部ポートグループで両方のアダプタをアクティブとして設定できます。

次の例は、マルチノードONTAP Selectクラスタの内部および外部通信サービスを処理する vSwitch と 2 つのポート グループの構成を示しています。内部ネットワーク VMNIC はこのポート グループの一部であり、スタンバイ モードで構成されているため、ネットワーク障害が発生した場合に外部ネットワークは内部ネットワーク VMNIC を使用できます。外部ネットワークの場合は逆になります。ネットワーク停止時にONTAP Select VM を正しくフェイルオーバーするには、2 つのポート グループ間でアクティブ VMNIC とスタンバイ VMNIC を交互に切り替えることが重要です。

* 各ノードに 2 つの物理ポート（ 10Gb 以下）を備えた vSwitch *

image:DDN_13.jpg["ノードごとに 2 つの物理ポートを備えた vSwitch"]



== LACP を使用した分散 vSwitch

分散 vSwitch を構成で使用する場合は、ネットワーク構成を簡易化するために LACP を使用できます（ただしベストプラクティスではありません）。サポートされる唯一の LACP 構成では、すべての VMNIC を 1 つの LAG にまとめる必要があります。アップリンクの物理スイッチは、チャネル内のすべてのポートで 7 、 500~9 、 000 の MTU をサポートする必要があります。ONTAP Select の内部ネットワークと外部ネットワークは、ポートグループレベルで分離する必要があります。内部ネットワークはルーティングされない（分離された） VLAN を使用する必要があります。外部ネットワークは VST 、 EST 、または VGT を使用できます。

次に、 LACP を使用した分散 vSwitch の設定例を示します。

* LACP 使用時の LAG プロパティ *

image:DDN_14.jpg["LACP を使用する場合の LAG プロパティ"]

* LACP が有効な分散 vSwitch を使用する外部ポートグループ構成 *

image:DDN_15.jpg["LACP が有効な分散 vSwitch を使用する外部ポートグループ構成"]

* LACP が有効な分散 vSwitch を使用する内部ポートグループ構成 *

image:DDN_16.jpg["LACP が有効な分散 vSwitch を使用する内部ポートグループ構成"]


NOTE: LACP では、アップストリーム スイッチ ポートをポート チャネルとして設定する必要があります。分散 vSwitch でこの設定を有効にする前に、LACP 対応ポート チャネルが正しく設定されていることを確認してください。
