---
sidebar: sidebar 
permalink: concept_ha_mirroring.html 
keywords: ontap select, ha, high availability, synchronous replication, mirrored aggregates, write path, raid syncmirror, rsm 
summary: RAID SyncMirror （ RSM ）、ミラーされたアグリゲート、および書き込みパスを使用してデータ損失を防止します。 
---
= HA RSM とミラーされたアグリゲート
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
RAID SyncMirror （ RSM ）、ミラーされたアグリゲート、および書き込みパスを使用してデータ損失を防止します。



== 同期レプリケーション

ONTAP の HA モデルは、 HA パートナーの概念に基づいています。ONTAP Select は、 ONTAP の RAID SyncMirror （ RSM ）機能を使用してクラスタノード間でデータブロックをレプリケートして、 HA ペア内でユーザデータのコピーが 2 つ保持されるようにすることで、このアーキテクチャを非共有型コモディティサーバへと拡張します。

メディエーターを持つ 2 ノードクラスタは、 2 つのデータセンターにまたがることができます。詳細については、を参照してください link:reference_plan_best_practices.html#two-node-stretched-ha-metrocluster-sds-best-practices["2 ノードストレッチ HA （ MetroCluster SDS ）のベストプラクティス"]。



== ミラーされたアグリゲート

ONTAP Select クラスタは、 2~8 ノードで構成されます。各 HA ペアにはユーザデータのコピーが 2 つ含まれ、 IP ネットワークを介してノード間で同期的にミラーリングされます。このミラーリングはユーザに対して透過的であり、データアグリゲートのプロパティであり、データアグリゲートの作成プロセス中に自動的に設定されます。

ONTAP Select クラスタ内のすべてのアグリゲートは、ノードのフェイルオーバー時にデータ可用性を実現し、ハードウェア障害時の SPOF を回避するため、ミラーリングする必要があります。ONTAP Select クラスタ内のアグリゲートは、 HA ペアの各ノードが提供する仮想ディスクから作成され、次のディスクを使用します。

* 現在の ONTAP Select ノードが提供する 1 セットのローカルディスク
* 現在のノードの HA パートナーが提供する 1 セットのミラーディスク



NOTE: ミラーアグリゲートの作成に使用されるローカルディスクとミラーディスクは、同じサイズである必要があります。これらのアグリゲートは、プレックス 0 およびプレックス 1 と呼ばれます（ローカルミラーペアとリモートミラーペアを示す）。実際のプレックス番号は、環境によって異なる場合があります。

このアプローチは、標準的な ONTAP クラスタの動作とは根本的に異なります。この環境 は、 ONTAP Select クラスタ内のすべてのルートディスクとデータディスクを指します。アグリゲートには、データのローカルコピーとミラーコピーの両方が含まれます。したがって、 N 個の仮想ディスクを含むアグリゲートは、データの 2 番目のコピーが固有のディスクに保存されるため、 N /2 個分の一意のストレージを提供します。

次の図は、 4 ノード ONTAP Select クラスタ内の HA ペアを示しています。このクラスタには、両方の HA パートナーのストレージを使用する（テスト用の）アグリゲートが 1 つあります。このデータアグリゲートは、 2 セットの仮想ディスクで構成されます。 1 つは ONTAP Select が所有するクラスタノードが提供するローカルセット（プレックス 0 ）、もう 1 つはフェイルオーバーパートナーが提供するリモートセット（プレックス 1 ）です。

プレックス 0 は、すべてのローカルディスクを保持するバケットです。プレックス 1 は、ミラーディスク、つまりユーザデータの 2 つ目のレプリケートコピーを格納するディスクを保持するバケットです。アグリゲートを所有するノードはプレックス 0 にディスクを提供し、そのノードの HA パートナーはプレックス 1 にディスクを提供します。

次の図では、 2 本のディスクで構成されるミラーアグリゲートがあります。このアグリゲートの内容が 2 つのクラスタノード間でミラーされます。この場合、ローカルディスク NET-1.1 はプレックス 0 バケットに配置され、リモートディスク NET-2.1 はプレックス 1 バケットに配置されます。この例では、アグリゲート test は左側のクラスタノードによって所有され、ローカルディスク NET-1.1 と HA パートナーのミラーディスク NET-2.1 を使用します。

* ONTAP Select ミラーアグリゲート *image:DDHA_03.jpg["ONTAP Select ミラーされたアグリゲート"]


NOTE: ONTAP Select クラスタの導入時にシステム上のすべての仮想ディスクが自動的に正しいプレックスに割り当てられるため、ディスクの割り当てに関してユーザが追加の作業を行う必要ありません。そのため、ディスクが間違ったプレックスに誤って割り当てられることがなく、最適なミラーディスク構成が確実に作成されます。



== 書き込みパス

クラスタノード間でデータブロックが同期ミラーリングされること、またシステム障害発生時にデータ損失ゼロが求められることは、受信した書き込みが ONTAP Select クラスタ全体に伝播される際のパスに大きく影響します。このプロセスは、次の 2 つの段階で構成されます

* 確認応答
* デステージ


ターゲットボリュームへの書き込みはデータ LIF 経由で行われ、 ONTAP Select ノードのシステムディスク上の仮想 NVRAM パーティションにコミットされてから、クライアントに確認応答が返されます。HA 構成の場合は、確認応答の前に、 NVRAM への書き込みがターゲットボリュームを所有するノードの HA パートナーにただちにミラーされます。このプロセスにより、元のノードでハードウェア障害が発生した場合でも、 HA パートナーノードでファイルシステムの整合性が確保されます。

書き込みが NVRAM にコミットされると、 ONTAP はこのパーティションの内容を適切な仮想ディスクに定期的に移動します。これがデステージと呼ばれるプロセスです。このプロセスは、ターゲットボリュームを所有するクラスタノードで 1 回だけ実行され、 HA パートナーでは実行されません。

次の図は、 ONTAP Select ノードへの書き込み要求の書き込みパスを示しています。

* ONTAP Select 書き込みパスのワークフロー *image:DDHA_04.jpg["ONTAP Select 書き込みパスのワークフロー"]

書き込みの確認応答は、次の手順で行われます。

* ONTAP Select ノード A が所有する論理インターフェイス経由で書き込みがシステムに送信されます
* 書き込みはノード A の NVRAM にコミットされ、 HA パートナーであるノード B にミラーされます
* I/O 要求が両方の HA ノードに到達した時点で、クライアントに要求の確認応答が返されます。


NVRAM からデータアグリゲートへの ONTAP Select のデステージ（ ONTAP CP ）は、次の手順で行われます。

* 仮想 NVRAM から仮想データアグリゲートに書き込みがデステージされます。
* ミラーエンジンが両方のプレックスにブロックを同期的にレプリケートします。

